# Docker Timezone Configuration Issue & Fix

**Issue Date:** October 21, 2025 at 10:55 PDT  
**Status:** ‚ö†Ô∏è **CONFIGURATION ISSUE IDENTIFIED**

---

## Issue Summary

The Danshari Docker container is currently running in **UTC timezone** instead of **Pacific Time (PST/PDT)** as expected.

### Current Configuration

| Component | Timezone | Current Time |
|-----------|----------|--------------|
| **Docker Container** | UTC | 17:55:38 |
| **Your Local Time** | PST/PDT | 10:55:38 |
| **Time Difference** | -7 hours | (UTC is 7 hours ahead) |

### Root Cause

The `TZ` (timezone) environment variable is **not set** in the `docker-compose.yml` configuration file.

**Current State:**
- ‚ùå No `TZ` environment variable in docker-compose.yml
- ‚ùå Container defaults to UTC timezone
- ‚ùå `/etc/localtime` symlinked to `Etc/UTC`

---

## Impact

### What's Affected

1. **Log Timestamps:** All application logs show UTC time instead of Pacific Time
   ```
   Current:  2025-10-21T17:55:38Z  (UTC)
   Expected: 2025-10-21T10:55:38-07:00  (PDT)
   ```

2. **Database Timestamps:** Any timestamps stored without explicit timezone may be in UTC

3. **Scheduled Tasks:** Any cron jobs or scheduled tasks run based on UTC time

4. **User Confusion:** Time-based operations and debugging can be confusing with 7-8 hour offset

### What's NOT Affected

- ‚úÖ Application functionality (still works correctly)
- ‚úÖ User sessions (browsers use client timezone)
- ‚úÖ API responses (if using timezone-aware timestamps)

---

## Solution

### Option 1: Add TZ Environment Variable (Recommended)

Add the `TZ` environment variable to the `docker-compose.yml` file.

**File Location:** `/home/dx/danshari-deploy/docker-compose.yml`

**Add this line to the `environment:` section:**
```yaml
environment:
  - TZ=America/Los_Angeles  # Add this line
  - MAX_CHAT_SIZE=${MAX_CHAT_SIZE}
  - MAX_MESSAGE_LENGTH=${MAX_MESSAGE_LENGTH}
  # ... rest of environment variables
```

**Why `America/Los_Angeles`?**
- This timezone automatically handles PST (Pacific Standard Time) in winter
- And PDT (Pacific Daylight Time) in summer
- Follows US daylight saving time rules

### Option 2: Mount Timezone Files (Alternative)

Add volume mounts to share host timezone:
```yaml
volumes:
  - /etc/localtime:/etc/localtime:ro
  - /etc/timezone:/etc/timezone:ro
```

**Note:** This only works if the host is also configured for Pacific Time (currently it's UTC).

---

## Implementation Steps

### Step 1: Backup Current Configuration

```bash
gcloud compute ssh danshari-v-25 --zone=us-west2-a --command='
  cd /home/dx/danshari-deploy && 
  sudo cp docker-compose.yml docker-compose.yml.backup-$(date +%Y%m%d-%H%M%S)
'
```

### Step 2: Add TZ Environment Variable

```bash
gcloud compute ssh danshari-v-25 --zone=us-west2-a --command='
  cd /home/dx/danshari-deploy && 
  sudo sed -i "/environment:/a\      - TZ=America/Los_Angeles" docker-compose.yml
'
```

### Step 3: Restart Container

```bash
gcloud compute ssh danshari-v-25 --zone=us-west2-a --command='
  cd /home/dx/danshari-deploy && 
  docker compose restart app
'
```

### Step 4: Verify the Fix

```bash
# Check new timezone
gcloud compute ssh danshari-v-25 --zone=us-west2-a --command='
  docker exec danshari-compose date "+%Z %z - %Y-%m-%d %H:%M:%S"
'

# Should show: PDT -0700 - 2025-10-21 10:55:38
```

---

## Timeline Configuration

### Pacific Time Details

| Period | Timezone | UTC Offset | Example |
|--------|----------|------------|---------|
| **Winter (Nov-Mar)** | PST (Pacific Standard Time) | UTC-8 | 09:00 PST = 17:00 UTC |
| **Summer (Mar-Nov)** | PDT (Pacific Daylight Time) | UTC-7 | 10:00 PDT = 17:00 UTC |

**Current Period:** PDT (Pacific Daylight Time) - UTC-7

**Next Change:** November 2, 2025 at 2:00 AM (Fall back to PST)

---

## Verification Checklist

After applying the fix, verify:

- [ ] Container timezone shows `PDT -0700` (or `PST -0800` in winter)
- [ ] `docker exec danshari-compose date` shows correct Pacific time
- [ ] `printenv TZ` shows `America/Los_Angeles`
- [ ] Log timestamps match your local time
- [ ] Container health check still passing
- [ ] Application functioning normally

---

## Docker Compose Configuration Reference

### Before (Current - UTC)
```yaml
services:
  app:
    image: ghcr.io/open-webui/open-webui:main
    container_name: danshari-compose
    environment:
      - MAX_CHAT_SIZE=${MAX_CHAT_SIZE}
      - MAX_MESSAGE_LENGTH=${MAX_MESSAGE_LENGTH}
      # ... (no TZ variable)
```

### After (Recommended - Pacific Time)
```yaml
services:
  app:
    image: ghcr.io/open-webui/open-webui:main
    container_name: danshari-compose
    environment:
      - TZ=America/Los_Angeles          # ‚Üê ADD THIS LINE
      - MAX_CHAT_SIZE=${MAX_CHAT_SIZE}
      - MAX_MESSAGE_LENGTH=${MAX_MESSAGE_LENGTH}
      # ...
```

---

## Common Timezone Values

For reference, here are other US timezone values:

| Timezone | Value | UTC Offset (Standard) |
|----------|-------|----------------------|
| Pacific | `America/Los_Angeles` | UTC-8 (PST) |
| Mountain | `America/Denver` | UTC-7 (MST) |
| Central | `America/Chicago` | UTC-6 (CST) |
| Eastern | `America/New_York` | UTC-5 (EST) |
| Alaska | `America/Anchorage` | UTC-9 (AKST) |
| Hawaii | `Pacific/Honolulu` | UTC-10 (HST) |

---

## Expected Outcome

### Current Behavior
```
$ docker logs danshari-compose --tail 5
2025-10-21T17:55:38.123456Z INFO - User logged in
2025-10-21T17:55:39.234567Z INFO - Chat created
```

### After Fix
```
$ docker logs danshari-compose --tail 5
2025-10-21T10:55:38.123456-0700 INFO - User logged in
2025-10-21T10:55:39.234567-0700 INFO - Chat created
```

---

## Restart Impact

**Downtime:** ~5-10 seconds for container restart  
**Data Loss:** None (only restarts the app container)  
**User Impact:** Brief interruption during restart  

**Best Time to Apply:**
- During low-traffic period
- Or immediately (impact is minimal)

---

## Alternative: System-Wide Timezone Change

If you prefer ALL containers to use Pacific Time, you can change the host system timezone:

```bash
# On the GCP instance (not recommended as it affects all containers)
sudo timedatectl set-timezone America/Los_Angeles
```

**Why not recommended:**
- Affects all containers and system processes
- May have unexpected impacts
- Better to configure per-container

---

## Troubleshooting

### Issue: Timezone not changing after restart

**Solution:** Force recreate the container
```bash
cd /home/dx/danshari-deploy
docker compose down
docker compose up -d
```

### Issue: TZ variable set but still showing UTC

**Check:**
1. Verify TZ is in the right place in docker-compose.yml
2. Ensure proper indentation (must be under `environment:`)
3. Check for typos in `America/Los_Angeles`

### Issue: Container won't start after changes

**Rollback:**
```bash
cd /home/dx/danshari-deploy
sudo cp docker-compose.yml.backup-* docker-compose.yml
docker compose restart app
```

---

## Related Issues

This timezone issue is separate from the previously fixed health check issue. Both fixes can coexist without conflict.

---

## Recommendation

**Priority:** MEDIUM (Quality of Life improvement)  
**Risk:** LOW (minimal restart required)  
**Complexity:** SIMPLE (one-line change)  
**Benefit:** HIGH (better log readability and debugging)

**Suggested Action:** Apply the fix at your earliest convenience.

---

## Next Steps

Would you like me to:
1. ‚úÖ Apply this fix now (adds TZ=America/Los_Angeles)
2. ‚è∏Ô∏è  Wait for a better time
3. üìù Just document it for manual application later

Let me know and I can proceed with the implementation!

---

**Report Generated:** October 21, 2025 at 10:55 PDT  
**File Location:** `/home/dx/danshari-deploy/docker-compose.yml`  
**Container:** danshari-compose  
**Current Status:** Running (UTC timezone)

